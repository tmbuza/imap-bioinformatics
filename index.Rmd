---
title: "Microbiome Bioinformatics Pipelines<br>"
subtitle: "Fostering continuous integration with Snakemake workflow engine <br><br>"
author: TMBuza
date: |
  | ![](images/new_horizon.png)<br><br>
  | Updated on `r Sys.time()` <br><br>
email_address: "tmbuza@complexdatainsights.com"
github_repo: "https://github.com/tmbuza/imap-mothur"
github_page: "https://tmbuza.github.io/imap-mothur/"
related_website: "https://complexdatainsights.com"
---

<br><br>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">


```{r echo=FALSE, message=FALSE, warning=FALSE}

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  cache = FALSE,
  comment = NA,
  fig.path='./figures/',
  fig.show='asis',
  dev = 'png',
  fig.align='center',
  out.width = "70%",
  fig.width = 7,
  fig.asp = 0.7,
  fig.show = "asis"
)
library(tidyverse, suppressPackageStartupMessages())

```

```{css echo = FALSE}
.author {
  display: none;
} 
.main-container {
  max-width: 80%;
  background-color: black;
  color: white;
  padding: 3% 3% 3% 3%;
  margin-left: auto;
  margin-right: auto;
}
body{
  font-size: 14px;
  text-align: left;
}

#header {
  background-color: #013011;
  color: white;
  font-family: "Montserrat", sans-serif;
  text-align: center;
  width: 100%;
  padding: 5% 0% 0% 0%;
  text-transform: none;
  font-weight: bold;
  background-image: url("images/bkgd.jpg");
  /* background-image: url("images/bkgd.jpg"), url("mothurpipe.png"); */
  background-repeat: no-repeat, repeat;
  background-color: #cccccc; /* Used if the image is unavailable */
  height: 100%; /* You must set a specified height */
  background-position: center; /* Center the image */
  background-size: cover; /* Resize the background image to cover the entire container */
  
}
@media only screen and (max-width: 768px) {
  .main-container {
  max-width: 100%;
  background-color: black;
  color: white;
  padding: 1% 1% 1% 1%;
  margin-left: auto;
  margin-right: auto;

  }
  #header {
  background-color: #013011;
  color: white;
  font-family: "Montserrat", sans-serif;
  text-align: center;
  width: 100%;
  padding: 5% 0% 0% 0%;
  text-transform: none;
  font-weight: bold;
  background-image: url("images/bkgd.jpg");
  /* background-image: url("images/bkgd.jpg"), url("mothurpipe.png"); */
  background-repeat: no-repeat, repeat;
  background-color: #cccccc; /* Used if the image is unavailable */
  height: 100%; /* You must set a specified height */
  background-position: center; /* Center the image */
  background-size: cover; /* Resize the background image to cover the entire container */
  
  }
   body {
    font-size: 12px;
    width: 100%;
  }
  #header h1{
    font-size: 2em;  
  }
  #glimpse h1{
    font-size: 2em;
  } 
  #glimpse p{
    font-size: 1.5em;
  } 
  #footer {
    text-align: left;
    font-size: 1.1em;
  } 
  #header h3{
    font-size: 1.8em;
  }
  #header img{
  max-width:80%;
  }
  #tablefield {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
} 
body h1{
  font-size: 1.8em;
  text-transform: capitalize;
}
body h2{
  font-size: 1.6em;
}

body h3{
  font-size: 1.6em;
}

#tablefield h2{
  font-size: 1.6em;
}

}


#header h3, #glimpse h1{
  color: #b5f56b;
}

#header h1{
  font-size: 4em;
}

#header h3{
  font-size: 2.0em;
}
#header img{
width:70%;
}

body {
  background-color: F5F5F5;
  color: white;
  font-family: "Montserrat", sans-serif;
}
body h1{
  font-size: 2.5em;
  text-transform: capitalize;
}
body h2{
  font-size: 2.0em;
}

body h3{
  font-size: 1.6em;
}

table tbody tr td {
  font-size: 14px;
  text-transform: capitalize;
}
body img{
  width: 100%;
  display: block;
  margin-left: auto;
  margin-right: auto;
  padding: 20px, 50px, 20px, 50px;
}
#glimpse{
  text-align: center;
}

#glimpse h1{
  text-transform: none;
}

a{
  color: #6bb7f5;
}
#tablefield {
  max-width: 80%;
  margin-left: auto;
  margin-right: auto;
}

 
```

<br>
<br>
<br>

# Mothur bioinformatics pipeline
<!-- ![](dags/rulegraph.svg) -->
<img src="dags/rulegraph.svg"/>

## Summary report

<!-- ![](dags/rulegraph.svg) -->
<img src="dags/summary_report_dag.png"/>



# Metadata profiling
```{r}
library(tidyverse, suppressPackageStartupMessages())
sraruntable <- read_delim("data/metadata/SraRunTable.txt", show_col_types = FALSE)

metadata <- sraruntable %>%  
  rename_all(tolower) %>% 
  rename(sample_id = run) %>% 
  drop_na(lat_lon) %>% 
  mutate(
    geo_loc_name = str_replace_all(geo_loc_name, "Tanzania: ", ""),
    geo_loc_name = str_replace_all(geo_loc_name, "The Greater Serengeti Ecosystem", "Serengeti"),
    geo_loc_name = str_replace_all(geo_loc_name, " Ecosystem", ""),
    isolate = str_replace_all(isolate, "_\\d*$", ""),
    lat_lon = str_replace_all(lat_lon, " E$", ""),
    latitude = as.numeric(str_replace_all(lat_lon, " S.*", "")) * -1,
    longitude = as.numeric(str_replace_all(lat_lon, ".*S ", ""))) %>% 
  rename(ecosystem = geo_loc_name) %>%
  rename(description = host) %>% 
  mutate(bases = round(bases/1E6, digits = 0)) %>% 
  select(sample_id, ecosystem, isolate, latitude, longitude, milionbases=bases, description)
```

```{r readsize}
 metadata %>% 
  ggplot(aes(x = isolate, y = milionbases, fill = ecosystem)) +
  facet_grid(~ ecosystem) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(x = "Animal Name", y = "Read size (milion bases)") +
  theme_light()
```


## Useful links
[https://github.com/wclose/mothurPipeline](https://github.com/wclose/mothurPipeline)



<br><br><hr>

<div id="footer">
Last updated on `r format(Sys.time(), '%B %d, %Y')`. <br><br>
These microbiome workflows are continuously being reviewed, integrated, tested by [Teresia Mrema-Buza](mailto:`r rmarkdown::metadata$email_address`).  
Github_Repo: `r rmarkdown::metadata$github_repo`.  
Github_Page: `r rmarkdown::metadata$github_page`.  
Visit the [CDI website](`r rmarkdown::metadata$related_website`) for more practical user guides (...in progress).  
</div>